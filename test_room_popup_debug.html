<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Room Battle Popup Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .countdown-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 53, 69, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: popupFadeIn 0.3s ease-out;
        }
        
        .countdown-content {
            text-align: center;
        }
        
        .countdown-number {
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: countdownPulse 1s ease-in-out infinite;
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes countdownPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Test Room Battle Popup Debug</h1>
        
        <div class="test-section">
            <h3>üéØ Test Popup Countdown</h3>
            <button id="test-popup-btn" class="btn">Test Popup 5 Gi√¢y</button>
            <button id="test-sound-btn" class="btn">Test √Çm Thanh Pre</button>
            <button id="test-battle-btn" class="btn">Test √Çm Thanh Battle</button>
            <button id="reset-btn" class="btn btn-danger">Reset</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Tr·∫°ng th√°i hi·ªán t·∫°i</h3>
            <div class="debug-info">
                <div><span class="status-indicator" id="popup-status"></span>Popup Element: <span id="popup-status-text">Ch∆∞a ki·ªÉm tra</span></div>
                <div><span class="status-indicator" id="sound-status"></span>√Çm Thanh Element: <span id="sound-status-text">Ch∆∞a ki·ªÉm tra</span></div>
                <div><span class="status-indicator" id="countdown-status"></span>Countdown Status: <span id="countdown-status-text">Ch∆∞a ki·ªÉm tra</span></div>
                <div>Sound Enabled: <span id="sound-enabled-text">true</span></div>
                <div>Is Countdown Active: <span id="countdown-active-text">false</span></div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìù Console Log</h3>
            <div id="console-log" class="debug-info" style="max-height: 200px; overflow-y: auto;">
                <div>Console log s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
            </div>
        </div>
    </div>
    
    <!-- Countdown popup -->
    <div id="countdown-popup" class="countdown-popup">
        <div class="countdown-content">
            <div class="countdown-number" id="countdown-number">5</div>
        </div>
    </div>
    
    <!-- Audio elements -->
    <audio id="battle-sound" preload="auto">
        <source src="/sounds/soudKD.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="pre-battle-sound" preload="auto">
        <source src="/sounds/pre_KD.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // Console log override ƒë·ªÉ hi·ªÉn th·ªã trong UI
        const originalLog = console.log;
        const consoleLogDiv = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
            consoleLogDiv.appendChild(logEntry);
            consoleLogDiv.scrollTop = consoleLogDiv.scrollHeight;
        };
        
        // Get elements
        const countdownPopup = document.getElementById('countdown-popup');
        const countdownNumber = document.getElementById('countdown-number');
        const battleSound = document.getElementById('battle-sound');
        const preBattleSound = document.getElementById('pre-battle-sound');
        
        // State variables
        let soundEnabled = true;
        let isCountdownActive = false;
        
        // Update status display
        function updateStatus() {
            // Popup status
            const popupStatus = document.getElementById('popup-status');
            const popupStatusText = document.getElementById('popup-status-text');
            if (countdownPopup) {
                popupStatus.className = 'status-indicator status-success';
                popupStatusText.textContent = '‚úÖ T√¨m th·∫•y';
            } else {
                popupStatus.className = 'status-indicator status-error';
                popupStatusText.textContent = '‚ùå Kh√¥ng t√¨m th·∫•y';
            }
            
            // Sound status
            const soundStatus = document.getElementById('sound-status');
            const soundStatusText = document.getElementById('sound-status-text');
            if (preBattleSound && battleSound) {
                soundStatus.className = 'status-indicator status-success';
                soundStatusText.textContent = '‚úÖ T√¨m th·∫•y c·∫£ hai';
            } else {
                soundStatus.className = 'status-indicator status-error';
                soundStatusText.textContent = '‚ùå Thi·∫øu element';
            }
            
            // Countdown status
            const countdownStatus = document.getElementById('countdown-status');
            const countdownStatusText = document.getElementById('countdown-status-text');
            if (isCountdownActive) {
                countdownStatus.className = 'status-indicator status-warning';
                countdownStatusText.textContent = '‚è∞ ƒêang ƒë·∫øm ng∆∞·ª£c';
            } else {
                countdownStatus.className = 'status-indicator status-success';
                countdownStatusText.textContent = '‚úÖ S·∫µn s√†ng';
            }
            
            // Other status
            document.getElementById('sound-enabled-text').textContent = soundEnabled;
            document.getElementById('countdown-active-text').textContent = isCountdownActive;
        }
        
        // Show countdown popup function (copy from room-battle.js)
        function showCountdownPopup() {
            console.log('üéØ showCountdownPopup ƒë∆∞·ª£c g·ªçi!');
            console.log('üîä soundEnabled:', soundEnabled);
            console.log('‚è∞ isCountdownActive:', isCountdownActive);
            
            if (!soundEnabled || isCountdownActive) {
                console.log('‚ùå Kh√¥ng th·ªÉ hi·ªán popup - soundEnabled:', soundEnabled, 'isCountdownActive:', isCountdownActive);
                return;
            }
            
            isCountdownActive = true;
            console.log('‚úÖ B·∫Øt ƒë·∫ßu hi·ªÉn th·ªã popup ƒë·∫øm ng∆∞·ª£c!');
            
            // Hi·ªÉn th·ªã popup
            countdownPopup.style.display = 'flex';
            countdownNumber.textContent = '5';
            console.log('üì± Popup ƒë√£ hi·ªán, s·ªë ƒë·∫øm: 5');
            
            // Ph√°t √¢m thanh pre-battle
            if (preBattleSound) {
                preBattleSound.currentTime = 0;
                preBattleSound.volume = 0.7;
                preBattleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh pre-battle:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh pre-battle...');
            } else {
                console.log('‚ùå preBattleSound kh√¥ng t·ªìn t·∫°i!');
            }
            
            // ƒê·∫øm ng∆∞·ª£c t·ª´ 5 gi√¢y
            let count = 5;
            const countdownInterval = setInterval(() => {
                count--;
                countdownNumber.textContent = count;
                console.log('‚è∞ ƒê·∫øm ng∆∞·ª£c:', count);
                
                if (count <= 0) {
                    clearInterval(countdownInterval);
                    isCountdownActive = false;
                    console.log('‚úÖ ƒê·∫øm ng∆∞·ª£c ho√†n th√†nh, ·∫©n popup sau 1 gi√¢y...');
                    // ·∫®n popup sau 1 gi√¢y
                    setTimeout(() => {
                        countdownPopup.style.display = 'none';
                        console.log('üì± Popup ƒë√£ ·∫©n');
                        updateStatus();
                    }, 1000);
                }
            }, 1000);
            
            updateStatus();
        }
        
        // Event listeners
        document.getElementById('test-popup-btn').addEventListener('click', function() {
            console.log('üß™ Test popup ƒë∆∞·ª£c click');
            showCountdownPopup();
        });
        
        document.getElementById('test-sound-btn').addEventListener('click', function() {
            console.log('üß™ Test √¢m thanh pre ƒë∆∞·ª£c click');
            if (preBattleSound) {
                preBattleSound.currentTime = 0;
                preBattleSound.volume = 0.7;
                preBattleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh pre:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh pre...');
            }
        });
        
        document.getElementById('test-battle-btn').addEventListener('click', function() {
            console.log('üß™ Test √¢m thanh battle ƒë∆∞·ª£c click');
            if (battleSound) {
                battleSound.currentTime = 0;
                battleSound.volume = 0.7;
                battleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh battle:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh battle...');
            }
        });
        
        document.getElementById('reset-btn').addEventListener('click', function() {
            console.log('üîÑ Reset ƒë∆∞·ª£c click');
            isCountdownActive = false;
            countdownPopup.style.display = 'none';
            if (preBattleSound) preBattleSound.pause();
            if (battleSound) battleSound.pause();
            updateStatus();
        });
        
        // Initialize
        console.log('üöÄ Test page ƒë√£ load');
        console.log('üîç countdownPopup:', countdownPopup);
        console.log('üîç countdownNumber:', countdownNumber);
        console.log('üîç battleSound:', battleSound);
        console.log('üîç preBattleSound:', preBattleSound);
        
        updateStatus();
    </script>
</body>
</html> 