<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Room Battle Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .countdown-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 53, 69, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: popupFadeIn 0.3s ease-out;
        }
        
        .countdown-content {
            text-align: center;
        }
        
        .countdown-number {
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: countdownPulse 1s ease-in-out infinite;
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes countdownPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Room Battle Simple</h1>
        
        <div class="debug-info">
            <h3>üéØ Test Popup Countdown</h3>
            <button id="test-popup-btn" class="btn">Test Popup 5 Gi√¢y</button>
            <button id="test-sound-btn" class="btn">Test √Çm Thanh Pre</button>
            <button id="test-battle-btn" class="btn">Test √Çm Thanh Battle</button>
        </div>
        
        <div class="debug-info">
            <h3>üìä Tr·∫°ng th√°i hi·ªán t·∫°i</h3>
            <div>Sound Enabled: <span id="sound-enabled-text">true</span></div>
            <div>Is Countdown Active: <span id="countdown-active-text">false</span></div>
            <div>All Questions Length: <span id="questions-length-text">0</span></div>
        </div>
        
        <div class="debug-info">
            <h3>üìù Console Log</h3>
            <div id="console-log" style="max-height: 200px; overflow-y: auto;">
                <div>Console log s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
            </div>
        </div>
    </div>
    
    <!-- Countdown popup -->
    <div id="countdown-popup" class="countdown-popup">
        <div class="countdown-content">
            <div class="countdown-number" id="countdown-number">5</div>
        </div>
    </div>
    
    <!-- Audio elements -->
    <audio id="battle-sound" preload="auto">
        <source src="/sounds/soudKD.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="pre-battle-sound" preload="auto">
        <source src="/sounds/pre_KD.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // Console log override ƒë·ªÉ hi·ªÉn th·ªã trong UI
        const originalLog = console.log;
        const consoleLogDiv = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
            consoleLogDiv.appendChild(logEntry);
            consoleLogDiv.scrollTop = consoleLogDiv.scrollHeight;
        };
        
        // Get elements
        const countdownPopup = document.getElementById('countdown-popup');
        const countdownNumber = document.getElementById('countdown-number');
        const battleSound = document.getElementById('battle-sound');
        const preBattleSound = document.getElementById('pre-battle-sound');
        
        // State variables (copy t·ª´ room-battle.js)
        let soundEnabled = true;
        let isCountdownActive = false;
        let allQuestions = []; // L∆∞u t·∫•t c·∫£ c√¢u h·ªèi
        let myQuestionOrder = []; // Th·ª© t·ª± c√¢u h·ªèi c·ªßa t√¥i
        let currentQuestionIndex = 0; // Reset v·ªÅ c√¢u ƒë·∫ßu ti√™n
        let totalTimeRemaining = 60; // 60 gi√¢y t·ªïng
        
        // Update status display
        function updateStatus() {
            document.getElementById('sound-enabled-text').textContent = soundEnabled;
            document.getElementById('countdown-active-text').textContent = isCountdownActive;
            document.getElementById('questions-length-text').textContent = allQuestions.length;
        }
        
        // Simulate question data
        function simulateQuestions() {
            allQuestions = [
                { id: 1, text: "C√¢u h·ªèi test 1", answer: "ƒë√°p √°n 1" },
                { id: 2, text: "C√¢u h·ªèi test 2", answer: "ƒë√°p √°n 2" },
                { id: 3, text: "C√¢u h·ªèi test 3", answer: "ƒë√°p √°n 3" }
            ];
            myQuestionOrder = [0, 1, 2]; // Th·ª© t·ª± c√¢u h·ªèi
            currentQuestionIndex = 0;
            console.log('‚úÖ ƒê√£ t·∫°o c√¢u h·ªèi test:', allQuestions);
            updateStatus();
        }
        
        // Show countdown popup function (copy t·ª´ room-battle.js)
        function showCountdownPopup() {
            console.log('üéØ showCountdownPopup ƒë∆∞·ª£c g·ªçi!');
            console.log('üîä soundEnabled:', soundEnabled);
            console.log('‚è∞ isCountdownActive:', isCountdownActive);
            console.log('üìö allQuestions length:', allQuestions.length);
            console.log('üî¢ myQuestionOrder:', myQuestionOrder);
            console.log('üìç currentQuestionIndex:', currentQuestionIndex);
            
            if (!soundEnabled || isCountdownActive) {
                console.log('‚ùå Kh√¥ng th·ªÉ hi·ªán popup - soundEnabled:', soundEnabled, 'isCountdownActive:', isCountdownActive);
                return;
            }
            
            // Ki·ªÉm tra xem c√≥ c√¢u h·ªèi kh√¥ng
            if (allQuestions.length === 0) {
                console.log('‚ùå Kh√¥ng th·ªÉ hi·ªán popup - ch∆∞a c√≥ c√¢u h·ªèi');
                return;
            }
            
            // Ki·ªÉm tra xem c√°c element c√≥ t·ªìn t·∫°i kh√¥ng
            if (!countdownPopup) {
                console.error('‚ùå countdownPopup kh√¥ng t·ªìn t·∫°i!');
                return;
            }
            if (!countdownNumber) {
                console.error('‚ùå countdownNumber kh√¥ng t·ªìn t·∫°i!');
                return;
            }
            
            isCountdownActive = true;
            console.log('‚úÖ B·∫Øt ƒë·∫ßu hi·ªÉn th·ªã popup ƒë·∫øm ng∆∞·ª£c!');
            
            // Hi·ªÉn th·ªã popup
            countdownPopup.style.display = 'flex';
            countdownNumber.textContent = '5';
            console.log('üì± Popup ƒë√£ hi·ªán, s·ªë ƒë·∫øm: 5');
            
            // Ph√°t √¢m thanh pre-battle
            if (preBattleSound) {
                preBattleSound.currentTime = 0;
                preBattleSound.volume = 0.7;
                preBattleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh pre-battle:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh pre-battle...');
            } else {
                console.log('‚ùå preBattleSound kh√¥ng t·ªìn t·∫°i!');
                console.error('‚ùå preBattleSound element kh√¥ng t√¨m th·∫•y!');
            }
            
            // Tranh th·ªß g·ªçi c√¢u h·ªèi v·ªÅ trong l√∫c ƒë·∫øm ng∆∞·ª£c
            console.log('üîÑ ƒêang chu·∫©n b·ªã c√¢u h·ªèi trong l√∫c ƒë·∫øm ng∆∞·ª£c...');
            
            // Chu·∫©n b·ªã c√¢u h·ªèi ƒë·∫ßu ti√™n ngay l·∫≠p t·ª©c
            const questionIndex = myQuestionOrder[currentQuestionIndex];
            const question = allQuestions[questionIndex];
            console.log('‚úÖ Chu·∫©n b·ªã c√¢u h·ªèi ƒë·∫ßu ti√™n:', question);
            console.log('üî¢ questionIndex:', questionIndex);
            console.log('üìö question object:', question);
            
            if (question) {
                console.log('‚úÖ C√¢u h·ªèi ƒë√£ s·∫µn s√†ng:', question.text);
            } else {
                console.error('‚ùå Kh√¥ng th·ªÉ l·∫•y c√¢u h·ªèi t·ª´ allQuestions!');
            }
            
            // ƒê·∫øm ng∆∞·ª£c t·ª´ 5 gi√¢y
            let count = 5;
            const countdownInterval = setInterval(() => {
                count--;
                countdownNumber.textContent = count;
                console.log('‚è∞ ƒê·∫øm ng∆∞·ª£c:', count);
                
                if (count <= 0) {
                    clearInterval(countdownInterval);
                    isCountdownActive = false;
                    console.log('‚úÖ ƒê·∫øm ng∆∞·ª£c ho√†n th√†nh, ·∫©n popup sau 1 gi√¢y...');
                    // ·∫®n popup sau 1 gi√¢y
                    setTimeout(() => {
                        if (countdownPopup) {
                            countdownPopup.style.display = 'none';
                            console.log('üì± Popup ƒë√£ ·∫©n');
                            updateStatus();
                        } else {
                            console.error('‚ùå countdownPopup kh√¥ng t·ªìn t·∫°i khi ·∫©n!');
                        }
                    }, 1000);
                }
            }, 1000);
            
            updateStatus();
        }
        
        // Event listeners
        document.getElementById('test-popup-btn').addEventListener('click', function() {
            console.log('üß™ Test popup ƒë∆∞·ª£c click');
            if (allQuestions.length === 0) {
                console.log('üìö T·∫°o c√¢u h·ªèi test tr∆∞·ªõc...');
                simulateQuestions();
            }
            showCountdownPopup();
        });
        
        document.getElementById('test-sound-btn').addEventListener('click', function() {
            console.log('üß™ Test √¢m thanh pre ƒë∆∞·ª£c click');
            if (preBattleSound) {
                preBattleSound.currentTime = 0;
                preBattleSound.volume = 0.7;
                preBattleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh pre:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh pre...');
            }
        });
        
        document.getElementById('test-battle-btn').addEventListener('click', function() {
            console.log('üß™ Test √¢m thanh battle ƒë∆∞·ª£c click');
            if (battleSound) {
                battleSound.currentTime = 0;
                battleSound.volume = 0.7;
                battleSound.play().catch(error => {
                    console.log('‚ùå Kh√¥ng th·ªÉ ph√°t √¢m thanh battle:', error);
                });
                console.log('üîä ƒêang ph√°t √¢m thanh battle...');
            }
        });
        
        // Initialize
        console.log('üöÄ Test page ƒë√£ load');
        console.log('üîç countdownPopup:', countdownPopup);
        console.log('üîç countdownNumber:', countdownNumber);
        console.log('üîç battleSound:', battleSound);
        console.log('üîç preBattleSound:', preBattleSound);
        
        updateStatus();
    </script>
</body>
</html> 